---
title: "Cocktail Installation on GKE"
excerpt: ""
permalink: /docs/ja/8.2.8/
redirect_from:
  - /theme-setup/
toc: true
toc_sticky: false
sidebar:
  nav: "ja"
---

### **事前準備**

インストール前に、インスタンスの準備及び以下のプログラムを予めインストールする必要があります。インストールされていない場合はエラーメッセージが表示されます。

1\) 提供された cube バイナリをどのディレクトリでも利用できるように、環境変数 path の設定をする。

2\) Docker ダウンロード後、インストール : [Get Docker CE for CentOS](https://docs.docker.com/install/linux/docker-ce/centos/)

3\) GKE サービスアカウントキーが用意されていなければならない。

4\) GKE ユーザーアカウントが証明された kubeconfig が用意されていなければならない。

5\) NFS Storageが用意されていなければならない。  
参考 : [GKE クラスター作成方法](../8.1.1.1)

-----

### **インストール**

**1. インストールのために空のディレクトリを作成後、そのディレクトリに移動する。**

```
# mkdir /Desktop/cube
# cd /Desktop/cube
```

**2. cube コマンドの -p Flag を使用して、各 Provider のインストール script を download して初期化する。**

| Provider list |
| ------------- |
| onpremise |
| aws |
| azure |
| gcp |
| aliyun |
| aks |
| eks |
| **gke** |

```
# cube init -p gke
```

**3. cube.toml ファイルをエディタで開いて Provider 情報およびインスタンス情報を記入する。**

-----

### Provider 別 cube.toml の作成方法

#### 事前準備

* サービスアカウント/キーの作成

  1. GCP コンソールで [**サービスアカウント** ページ](https://console.cloud.google.com/iam-admin/serviceaccounts)を開きます。

  2. **プロジェクトの選択**をクリックします。

  3. プロジェクトを選択し、**開く**をクリックします。

  4. **サービスアカウントの作成**をクリックします。

  5. サービス **アカウント名**の入力後、**CREATE**をクリックします。

      * Service account name : gke-test-cluster

      * Service account description : GKE cluster access

  6. サービスアカウントに付与する **役割(Kubernetes Engine Admin)**の選択後、**CONTINUE**をクリックします。

      * Service account permissions (optional) : Kubernetes Engine Admin

  7. Create key **+ CREATE KEY**をクリックします。

  8. **DONE**をクリックします。

  9. Download されたキー json ファイルを保管します。

  * 参考 : サービスアカウントが既にある場合は、**キー生成**のみ実施します。

    1. キーを作成するサービスアカウントを探し、該当行の**省略マーク**をクリックして **キーの作成**をクリックします。

    2. **キータイプ**(json)を選択して **作成**をクリックします。

  以下は、**Sample** 画面です。

  ![gke-create-service-account-key]({{ site.baseurl }}/assets/KR/{{ site.version }}/GKE/gke-create-service-account-key-1.png)
  ![gke-create-service-account-key]({{ site.baseurl }}/assets/KR/{{ site.version }}/GKE/gke-create-service-account-key-2.png)
  ![gke-create-service-account-key]({{ site.baseurl }}/assets/KR/{{ site.version }}/GKE/gke-create-service-account-key-3.png)
  ![gke-create-service-account-key]({{ site.baseurl }}/assets/KR/{{ site.version }}/GKE/gke-create-service-account-key-4.png)
  ![gke-create-service-account-key]({{ site.baseurl }}/assets/KR/{{ site.version }}/GKE/gke-create-service-account-key-5.png)



#### EKS cube.toml 作成


| <U>[cube]</U> |
| 項目 | 説明 | 例 |
| ---- | ---- | ---- |
| version | cube version (kubernetes version 毎に対応する cube version が異なる) | version = "1.13.5-r5" |
| provider | provider 使用設定 | provider = false |
| cluster-name | Cluster Name の付与 | cluster-name = "test-cluster" |
| cluster-description | Cluster Description | cluster-description = "This is test cluster" |
| cluster-type | クラスタの使用規模とHA構成可否によって、タイプを区別 **[large/medium/Small/tiny/kaas]** [Learn more](../8.1.2.9) | cluster-type = "kaas" |
| cluster-id | Cluster 固有 ID (Cocktail 画面から cluster 登録の際に使用される。) | cluster-id = "test-cluster-id" |
| alert-language | alert message 言語設定 | alert-language = "ko" |

<br/>

| <U>[gke]</U> |
| 項目 | 説明 | 例 |
| ---- | ---- | ---- |
| key-file-path | GKE サービスアカウントキー Path | key-file-path="key.json" |


<br/>

| <U>[node-pool]</U> |
| 項目 | 説明 | 例 |
| ---- | ---- | ---- |
| name | 使用している kaas name を入力する | name = "gke" |
| location | Kaas region を入力する | location = "asia-east1" |

<br/>

| <U>[node-pool.security]</U> |
| 項目 | 説明 | 例 |
| ---- | ---- | ---- |
| kube-config-path | kubernetes config path を入力する | kube-config-path = "./gke-kubeconfig" |

<br/>

| <U>[node-pool.master]</U> |
| 項目 | 説明 | 例 |
| ---- | ---- | ---- |
| internal-lb | EKS API server endpoint | internal-lb = "192.168.x.x" |
| external-lb | nodeport.eks.amazonaws.com | external-lb = "192.168.x.x |
| node-port-url | node-port-url | node-port-url = "192.168.x.x" |
| node-portrange | Node Portrange(30000-32767) | node-portrange = "30000-32767" |

<br/>

| <U>[[enterprise-product]]</U> |
| 項目 | 説明 | 例 |
| ---- | ---- | ---- |
| install | enterprise(cocktail-system) インストール可否をチェック | install = false |
| release-name | enterprise(リリース名-system) namespace をリリース名で使用 | release-name = "cocktail" |
| version | enterprise(cocktail-system) のインストール version | version="3.3.0" |
| https | https を使用するかどうか | https = false |

<br/>

| <U>[[enterprise-product.cert-file]]</U> : 上記 https = true の場合に適用する |
| 項目 | 説明 | 例 |
| ---- | ---- | ---- |
| ssl-certificate | ssl 証明書 path | ssl-certificate = "test.crt" |
| release-name | ssl 証明書 key path | ssl-certificate-key = "test.key" |


<br/>

| <U>[[addon]]</U> |
| 項目 | 説明 | 例 |
| ---- | ---- | ---- |
| install | cocktail addon(cocktail-addon) をインストールするかどうか | install = true |

<br/>

| <U>[shared-storage]</U> |
| 項目 | 説明 | 例 |
| ---- | ---- | ---- |
| install | NFS Storage をインストールするかどうか | install = false |
| storage-type | NAS Storage　を使用する場合、追加する必要がある | storage-type = nas |
| storage-ip | Storage IP | storage-ip = "192.168.x.x" |
| volume-size | Storage Volume Size | volume-size = 100 |
| volume-dir | Storage mount path | volume-dir = "/storage" | 

<br/>

| <U>[private-registry]</U> |
| 項目 | 説明 | 例 |
| ---- | ---- | ---- |
| install | registry(harbor) をインストールするかどうか | install = false |
| registry-ip | registry IP : harbor インストール | ip = "Your registry IP" |
| data-dir | Registry data directory path | data-dir = "/data" |
| public-cert | 認証を使用するかどうか | public-cert = false |

<br/>

| <U>[private-registry.cert-file]</U> : 上記 public-cert=true の場合に適用 |
| 項目 | 説明 | 例 |
| ---- | ---- | ---- |
| ssl-certificate | ssl 証明書 path | ssl-certificate = "test.crt" |
| release-name | ssl 証明書 key path | ssl-certificate-key = "test.key" |


#### 使用例
* cube init コマンドで初期 cube.toml ファイルを生成後、Provider 情報及びインスタンス情報を記入する。

```
# cube init -p eks
```

```
#using cubecli 2.6.3 or higher
#http://yum.acornsoft.io:8080/cube/linux/cube_linux_2.6.3
#http://yum.acornsoft.io:8080/cube/darwin/cube_darwin_2.6.3
#cube > version 1.13.5-r5 or higher


[cube]
version = "1.13.5-r5"
provider = false
cluster-name = "test-cluster"
cluster-description = "This is test cluster"
cluster-type = "kaas"
cluster-id = "test-cluster"
alert-language = "ko"


[gke]
key-file-path="key.json"


[node-pool]

  [node-pool.provider]
  name = "gke"
  location = "asia-east1"

  [node-pool.security]
  ssh-user-id = ""
  private-key-path = ""
  key-path = ""
  kube-config-path = "./gke-kubeconfg"

  [node-pool.master]
  internal-lb = "192.168.x.x"
  external-lb = "192.168.x.x"
  node-port-url = "192.168.x.x"
  node-portrange = "30000-32767"


[enterprise-product]
install = true
release-name = "cocktail"
version = "3.3.0"
https = false

  [enterprise-product.cert-file]
  ssl-certificate = ""
  ssl-certificate-key = ""


[addon]
install = true


[shared-storage]
install = fale
storage-ip = "192.168.x.x"
storage-volume-size = 100
storage-mount-dir = "/storage"


[private-registry]
install = false
registry-ip = "regi.acornsoft.io"
data-dir = "/data"
public-cert = true
  [private-registry.cert-file]
  ssl-certificate = ""
  ssl-certificate-key = ""
```

------
<br/>

**4. cube create コマンドを使用して、Cocktail Cluster をインストールする。**

```
# cube create
```

**5. エラー無くインストールが完了したら、system を構成するコンテナが正常起動しているかどうか、以下コマンドで確認する。**

```
# cube status
```